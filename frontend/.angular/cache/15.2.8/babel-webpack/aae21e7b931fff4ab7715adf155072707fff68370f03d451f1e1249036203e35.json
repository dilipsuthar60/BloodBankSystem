{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/hp/Documents/Arcs Infotech/blood-bank-system/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n// import { Component } from '@angular/core';\n// import { ActivatedRoute, Router } from '@angular/router';\n// import { HotToastService } from '@ngneat/hot-toast';\n// import { BloodBankService } from '../blood-bank.service';\n// import { Observable, map } from 'rxjs';\n// import Swal from 'sweetalert2';\nimport { __decorate } from \"tslib\";\n// @Component({\n//   selector: 'app-donor-home',\n//   templateUrl: './donor-home.component.html',\n//   styleUrls: ['./donor-home.component.css']\n// })\n// export class DonorHomeComponent {\n//   registeredCamps: any = {};\n//   camps: any;\n//   constructor(\n//     private toast: HotToastService,\n//     private router: Router,\n//     private route: ActivatedRoute,\n//     private bloodBankService: BloodBankService\n//   ) {}\n//   ngOnInit(): void {\n//     this.postCamps();\n//     // this.getRegistrationStatus();\n//   }\n//   postCamps(): void {\n//     this.bloodBankService.getCamps().subscribe(\n//       (data: any) => {\n//         this.camps = data;\n//         // console.log(data);\n//       }\n//     );\n//   }\n//   convertTo12HourFormat(timeString: any): string {\n//     const [hours, minutes] = timeString.split(\":\");\n//     let formattedTime: number;\n//     let period: string;\n//     if (hours < 12) {\n//       formattedTime = hours;\n//       period = \"AM\";\n//     } else {\n//       formattedTime = hours % 12;\n//       period = \"PM\";\n//     }\n//     return `${formattedTime}:${minutes} ${period}`;\n//   }\n//   isRegistered(camp: any): Observable<boolean> {\n//     const campId = camp.id;\n//     const donorId = Number(this.route.snapshot.paramMap.get('id'));\n//     console.log(donorId)\n//     const item = {\n//       campId,\n//       donorId\n//     };\n//     return this.bloodBankService.isRegister(item).pipe(\n//       map((data: any) => data.isRegistered)\n//     );\n//   }\n//   getRegistrationStatus(): void {\n//     const donorId = Number(this.route.snapshot.paramMap.get('id'));\n//     this.bloodBankService.campsRegistered(donorId).subscribe(\n//       (data: any) => {\n//         // console.log(data);\n//         this.registeredCamps = data.reduce((result: any, camp: any) => {\n//           result[camp.id] = true;\n//           return result;\n//         }, {});\n//       }\n//     );\n//   }\n//   onButtonClick(camp: any) {\n//     const isRegistered = this.registeredCamps[camp.id] || false;\n//     if (isRegistered) {\n//       this.unregisterCamp(camp);\n//     } else {\n//       this.registerCamp(camp);\n//     }\n//   }\n//   registerCamp(camp: any) {\n//     const campId = camp.id;\n//     const donorId = Number(this.route.snapshot.paramMap.get('id'));\n//     const item = {\n//       campId,\n//       donorId\n//     };\n//     this.bloodBankService.registerDonor(item).subscribe(\n//       (data: any) => {\n//         this.toast.success('Registered successfully');\n//         this.registeredCamps[camp.id] = true;\n//       },\n//       (error: any) => {\n//         this.toast.error(error.error.error.message);\n//       }\n//     );\n//   }\n//   async unregisterCamp(camp: any) {\n//     const shouldDelete = await Swal.fire({\n//       title: 'Are you sure?',\n//       text: 'You want to unregister from camp',\n//       icon: 'question',\n//       showCancelButton: true,\n//       confirmButtonColor: '#3085d6',\n//       cancelButtonColor: '#d33',\n//       confirmButtonText: 'Yes'\n//     });\n//     if(!shouldDelete.isConfirmed) return;\n//     const campId = camp.id;\n//     const donorId = Number(this.route.snapshot.paramMap.get('id'));\n//     const item = {\n//       campId,\n//       donorId\n//     };\n//     this.bloodBankService.unregisterDonor(item).subscribe(\n//       (data: any) => {\n//         this.toast.success('Unregistered successfully');\n//         this.registeredCamps[camp.id] = false;\n//       },\n//       (error: any) => {\n//         this.toast.error(error.error.error.message);\n//       }\n//     );\n//   }\n// }\nimport { Component } from '@angular/core';\nimport { map } from 'rxjs';\nimport Swal from 'sweetalert2';\nlet DonorHomeComponent = class DonorHomeComponent {\n  constructor(toast, router, route, bloodBankService, changeDetectorRef) {\n    this.toast = toast;\n    this.router = router;\n    this.route = route;\n    this.bloodBankService = bloodBankService;\n    this.changeDetectorRef = changeDetectorRef;\n    this.registeredCamps = {};\n    this.searchQuery = '';\n  }\n  ngOnInit() {\n    console.log(Number(this.route.snapshot.paramMap.get('id')));\n    const storedDonorID = sessionStorage.getItem('donorID');\n    if (storedDonorID && storedDonorID !== '0') {\n      this.donorID = Number(storedDonorID);\n    } else {\n      console.log(Number(this.route.snapshot.paramMap.get('id')));\n      const donorID = Number(this.route.snapshot.paramMap.get('id'));\n      sessionStorage.setItem('donorID', donorID.toString());\n      console.log(donorID);\n      this.donorID = donorID;\n    }\n    console.log(this.donorID);\n    this.getRegistrationStatus(this.donorID);\n    console.log(this.registeredCamps);\n    window.history.pushState({}, document.title, \"/\" + \"donor-home\");\n    this.postCamps();\n  }\n  postCamps() {\n    this.bloodBankService.getCamps().subscribe(data => {\n      this.camps = data;\n      this.filteredCamps = data;\n      this.changeDetectorRef.detectChanges();\n      // console.log(data);\n    });\n  }\n\n  convertTo12HourFormat(timeString) {\n    const [hours, minutes] = timeString.split(\":\");\n    let formattedTime;\n    let period;\n    if (hours < 12) {\n      formattedTime = hours;\n      period = \"AM\";\n    } else {\n      formattedTime = hours % 12;\n      period = \"PM\";\n    }\n    return `${formattedTime}:${minutes} ${period}`;\n  }\n  isRegistered(camp, donorId) {\n    const campId = camp.id;\n    const item = {\n      campId,\n      donorId\n    };\n    return this.bloodBankService.isRegister(item).pipe(map(data => data.isRegistered));\n  }\n  getRegistrationStatus(donorId) {\n    this.bloodBankService.campsRegistered(donorId).subscribe(data => {\n      // console.log(data);\n      this.registeredCamps = data.reduce((result, camp) => {\n        result[camp.id] = true;\n        return result;\n      }, {});\n    });\n  }\n  onButtonClick(camp) {\n    // const donorId = Number(this.route.snapshot.queryParams['id']);\n    const isRegistered = this.registeredCamps[camp.id] || false;\n    if (isRegistered) {\n      this.unregisterCamp(camp);\n    } else {\n      this.registerCamp(camp);\n    }\n  }\n  registerCamp(camp) {\n    const campId = camp.id;\n    const donorId = this.donorID;\n    const item = {\n      campId,\n      donorId\n    };\n    console.log(item);\n    this.bloodBankService.registerDonor(item).subscribe(data => {\n      this.toast.success('Registered successfully');\n      this.registeredCamps[camp.id] = true;\n    }, error => {\n      this.toast.error(error.error.error.message);\n    });\n  }\n  unregisterCamp(camp) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      const shouldDelete = yield Swal.fire({\n        title: 'Are you sure?',\n        text: 'You want to unregister from camp',\n        icon: 'question',\n        showCancelButton: true,\n        confirmButtonColor: '#3085d6',\n        cancelButtonColor: '#d33',\n        confirmButtonText: 'Yes'\n      });\n      if (!shouldDelete.isConfirmed) return;\n      const campId = camp.id;\n      const donorId = _this.donorID;\n      const item = {\n        campId,\n        donorId\n      };\n      _this.bloodBankService.unregisterDonor(item).subscribe(data => {\n        _this.toast.success('Unregistered successfully');\n        _this.registeredCamps[camp.id] = false;\n      }, error => {\n        _this.toast.error(error.error.error.message);\n      });\n    })();\n  }\n  logout() {\n    sessionStorage.removeItem('donorID');\n    sessionStorage.removeItem('isDonorLoggedIn');\n    this.toast.warning('You Have Been Logged Out ⚠️');\n    this.router.navigate(['donor-login']);\n  }\n  filterCamps() {\n    console.log(this.searchQuery);\n    console.log(this.filteredCamps);\n    this.filteredCamps = this.camps.filter(camp => camp.name.toLowerCase().includes(this.searchQuery.toLowerCase()));\n    console.log(this.filteredCamps);\n  }\n};\nDonorHomeComponent = __decorate([Component({\n  selector: 'app-donor-home',\n  templateUrl: './donor-home.component.html',\n  styleUrls: ['./donor-home.component.css']\n})], DonorHomeComponent);\nexport { DonorHomeComponent };","map":{"version":3,"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA,SAASA,SAAS,QAAQ,eAAe;AAIzC,SAAqBC,GAAG,QAAQ,MAAM;AACtC,OAAOC,IAAI,MAAM,aAAa;AAOvB,IAAMC,kBAAkB,GAAxB,MAAMA,kBAAkB;EAO7BC,YACUC,KAAsB,EACtBC,MAAc,EACdC,KAAqB,EACrBC,gBAAkC,EAClCC,iBAAoC;IAJpC,UAAK,GAALJ,KAAK;IACL,WAAM,GAANC,MAAM;IACN,UAAK,GAALC,KAAK;IACL,qBAAgB,GAAhBC,gBAAgB;IAChB,sBAAiB,GAAjBC,iBAAiB;IAX3B,oBAAe,GAAQ,EAAE;IAIzB,gBAAW,GAAW,EAAE;EAQrB;EAEHC,QAAQ;IACNC,OAAO,CAACC,GAAG,CAACC,MAAM,CAAC,IAAI,CAACN,KAAK,CAACO,QAAQ,CAACC,QAAQ,CAACC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC;IAC3D,MAAMC,aAAa,GAAGC,cAAc,CAACC,OAAO,CAAC,SAAS,CAAC;IACvD,IAAIF,aAAa,IAAIA,aAAa,KAAK,GAAG,EAAE;MAC1C,IAAI,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","names":["Component","map","Swal","DonorHomeComponent","constructor","toast","router","route","bloodBankService","changeDetectorRef","ngOnInit","console","log","Number","snapshot","paramMap","get","storedDonorID","sessionStorage","getItem","donorID","setItem","toString","getRegistrationStatus","registeredCamps","window","history","pushState","document","title","postCamps","getCamps","subscribe","data","camps","filteredCamps","detectChanges","convertTo12HourFormat","timeString","hours","minutes","split","formattedTime","period","isRegistered","camp","donorId","campId","id","item","isRegister","pipe","campsRegistered","reduce","result","onButtonClick","unregisterCamp","registerCamp","registerDonor","success","error","message","shouldDelete","fire","text","icon","showCancelButton","confirmButtonColor","cancelButtonColor","confirmButtonText","isConfirmed","unregisterDonor","logout","removeItem","warning","navigate","filterCamps","searchQuery","filter","name","toLowerCase","includes","selector","templateUrl","styleUrls"],"sourceRoot":"","sources":["C:\\Users\\hp\\Documents\\Arcs Infotech\\blood-bank-system\\src\\app\\donor-home\\donor-home.component.ts"],"sourcesContent":["// import { Component } from '@angular/core';\n// import { ActivatedRoute, Router } from '@angular/router';\n// import { HotToastService } from '@ngneat/hot-toast';\n// import { BloodBankService } from '../blood-bank.service';\n// import { Observable, map } from 'rxjs';\n// import Swal from 'sweetalert2';\n\n// @Component({\n//   selector: 'app-donor-home',\n//   templateUrl: './donor-home.component.html',\n//   styleUrls: ['./donor-home.component.css']\n// })\n// export class DonorHomeComponent {\n//   registeredCamps: any = {};\n//   camps: any;\n\n//   constructor(\n//     private toast: HotToastService,\n//     private router: Router,\n//     private route: ActivatedRoute,\n//     private bloodBankService: BloodBankService\n//   ) {}\n\n//   ngOnInit(): void {\n//     this.postCamps();\n//     // this.getRegistrationStatus();\n//   }\n\n//   postCamps(): void {\n//     this.bloodBankService.getCamps().subscribe(\n//       (data: any) => {\n//         this.camps = data;\n//         // console.log(data);\n//       }\n//     );\n//   }\n\n//   convertTo12HourFormat(timeString: any): string {\n//     const [hours, minutes] = timeString.split(\":\");\n//     let formattedTime: number;\n//     let period: string;\n\n//     if (hours < 12) {\n//       formattedTime = hours;\n//       period = \"AM\";\n//     } else {\n//       formattedTime = hours % 12;\n//       period = \"PM\";\n//     }\n\n//     return `${formattedTime}:${minutes} ${period}`;\n//   }\n\n//   isRegistered(camp: any): Observable<boolean> {\n//     const campId = camp.id;\n//     const donorId = Number(this.route.snapshot.paramMap.get('id'));\n//     console.log(donorId)\n//     const item = {\n//       campId,\n//       donorId\n//     };\n\n//     return this.bloodBankService.isRegister(item).pipe(\n//       map((data: any) => data.isRegistered)\n//     );\n//   }\n\n//   getRegistrationStatus(): void {\n//     const donorId = Number(this.route.snapshot.paramMap.get('id'));\n//     this.bloodBankService.campsRegistered(donorId).subscribe(\n//       (data: any) => {\n//         // console.log(data);\n//         this.registeredCamps = data.reduce((result: any, camp: any) => {\n//           result[camp.id] = true;\n//           return result;\n//         }, {});\n//       }\n//     );\n//   }\n\n//   onButtonClick(camp: any) {\n//     const isRegistered = this.registeredCamps[camp.id] || false;\n\n//     if (isRegistered) {\n//       this.unregisterCamp(camp);\n//     } else {\n//       this.registerCamp(camp);\n//     }\n//   }\n\n//   registerCamp(camp: any) {\n//     const campId = camp.id;\n//     const donorId = Number(this.route.snapshot.paramMap.get('id'));\n//     const item = {\n//       campId,\n//       donorId\n//     };\n\n//     this.bloodBankService.registerDonor(item).subscribe(\n//       (data: any) => {\n//         this.toast.success('Registered successfully');\n//         this.registeredCamps[camp.id] = true;\n//       },\n//       (error: any) => {\n//         this.toast.error(error.error.error.message);\n//       }\n//     );\n//   }\n\n//   async unregisterCamp(camp: any) {\n//     const shouldDelete = await Swal.fire({\n//       title: 'Are you sure?',\n//       text: 'You want to unregister from camp',\n//       icon: 'question',\n//       showCancelButton: true,\n//       confirmButtonColor: '#3085d6',\n//       cancelButtonColor: '#d33',\n//       confirmButtonText: 'Yes'\n//     });\n//     if(!shouldDelete.isConfirmed) return;\n\n//     const campId = camp.id;\n//     const donorId = Number(this.route.snapshot.paramMap.get('id'));\n//     const item = {\n//       campId,\n//       donorId\n//     };\n\n//     this.bloodBankService.unregisterDonor(item).subscribe(\n//       (data: any) => {\n//         this.toast.success('Unregistered successfully');\n//         this.registeredCamps[camp.id] = false;\n//       },\n//       (error: any) => {\n//         this.toast.error(error.error.error.message);\n//       }\n//     );\n//   }\n// }\n\n\nimport { Component } from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { HotToastService } from '@ngneat/hot-toast';\nimport { BloodBankService } from '../blood-bank.service';\nimport { Observable, map } from 'rxjs';\nimport Swal from 'sweetalert2';\n\n@Component({\n  selector: 'app-donor-home',\n  templateUrl: './donor-home.component.html',\n  styleUrls: ['./donor-home.component.css']\n})\nexport class DonorHomeComponent {\n  registeredCamps: any = {};\n  camps: any;\n  donorID: any\n  filteredCamps: any;\n  searchQuery: string = '';\n\n  constructor(\n    private toast: HotToastService,\n    private router: Router,\n    private route: ActivatedRoute,\n    private bloodBankService: BloodBankService,\n    private changeDetectorRef: ChangeDetectorRef\n  ) {}\n\n  ngOnInit(): void {\n    console.log(Number(this.route.snapshot.paramMap.get('id')))\n    const storedDonorID = sessionStorage.getItem('donorID');\n    if (storedDonorID && storedDonorID !== '0') {\n      this.donorID = Number(storedDonorID);\n    } else {\n      console.log(Number(this.route.snapshot.paramMap.get('id')))\n      const donorID = Number(this.route.snapshot.paramMap.get('id'));\n      sessionStorage.setItem('donorID', donorID.toString());\n      console.log(donorID)\n      this.donorID = donorID;\n    }\n    console.log(this.donorID)\n    \n    this.getRegistrationStatus(this.donorID);\n    console.log(this.registeredCamps)\n    window.history.pushState({}, document.title, \"/\" + \"donor-home\");\n    this.postCamps();\n  }\n\n  postCamps(): void {\n    this.bloodBankService.getCamps().subscribe(\n      (data: any) => {\n        this.camps = data;\n        this.filteredCamps = data;\n        this.changeDetectorRef.detectChanges();\n        // console.log(data);\n      }\n    );\n  }\n\n  convertTo12HourFormat(timeString: any): string {\n    const [hours, minutes] = timeString.split(\":\");\n    let formattedTime: number;\n    let period: string;\n\n    if (hours < 12) {\n      formattedTime = hours;\n      period = \"AM\";\n    } else {\n      formattedTime = hours % 12;\n      period = \"PM\";\n    }\n\n    return `${formattedTime}:${minutes} ${period}`;\n  }\n\n  isRegistered(camp: any, donorId: number): Observable<boolean> {\n    const campId = camp.id;\n    const item = {\n      campId,\n      donorId\n    };\n\n    return this.bloodBankService.isRegister(item).pipe(\n      map((data: any) => data.isRegistered)\n    );\n  }\n\n  getRegistrationStatus(donorId: number): void {\n    this.bloodBankService.campsRegistered(donorId).subscribe(\n      (data: any) => {\n        // console.log(data);\n        this.registeredCamps = data.reduce((result: any, camp: any) => {\n          result[camp.id] = true;\n          return result;\n        }, {});\n      }\n    );\n  }\n\n  onButtonClick(camp: any) {\n    // const donorId = Number(this.route.snapshot.queryParams['id']);\n    const isRegistered = this.registeredCamps[camp.id] || false;\n\n    if (isRegistered) {\n      this.unregisterCamp(camp);\n    } else {\n      this.registerCamp(camp);\n    }\n  }\n\n  registerCamp(camp: any) {\n    const campId = camp.id;\n    const donorId = this.donorID;\n    const item = {\n      campId,\n      donorId\n    };\n\n    console.log(item)\n\n    this.bloodBankService.registerDonor(item).subscribe(\n      (data: any) => {\n        this.toast.success('Registered successfully');\n        this.registeredCamps[camp.id] = true;\n      },\n      (error: any) => {\n        this.toast.error(error.error.error.message);\n      }\n    );\n  }\n\n  async unregisterCamp(camp: any) {\n    const shouldDelete = await Swal.fire({\n      title: 'Are you sure?',\n      text: 'You want to unregister from camp',\n      icon: 'question',\n      showCancelButton: true,\n      confirmButtonColor: '#3085d6',\n      cancelButtonColor: '#d33',\n      confirmButtonText: 'Yes'\n    });\n    if(!shouldDelete.isConfirmed) return;\n\n    const campId = camp.id;\n    const donorId = this.donorID;\n    const item = {\n      campId,\n      donorId\n    };\n\n    this.bloodBankService.unregisterDonor(item).subscribe(\n      (data: any) => {\n        this.toast.success('Unregistered successfully');\n        this.registeredCamps[camp.id] = false;\n      },\n      (error: any) => {\n        this.toast.error(error.error.error.message);\n      }\n    );\n  }\n\n  logout(): void {\n    sessionStorage.removeItem('donorID')\n    sessionStorage.removeItem('isDonorLoggedIn')\n    this.toast.warning('You Have Been Logged Out ⚠️')\n    this.router.navigate(['donor-login']);\n  }\n\n  filterCamps(): void {\n    console.log(this.searchQuery)\n    console.log(this.filteredCamps)\n    this.filteredCamps = this.camps.filter((camp: any) =>\n      camp.name.toLowerCase().includes(this.searchQuery.toLowerCase())\n    );\n    console.log(this.filteredCamps)\n  }\n  \n}\n\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}